# Формат CSV-файлов ФТС

Файлы в `data_raw/fts_data/` — прямые выгрузки таможенной статистики ФТС России (янв 2021 — янв 2022).

## Структура данных (по факту)

**Пример заголовка и строк из `2021-01.csv`:**

```
NAPR,PERIOD,STRANA,TNVED,EDIZM,STOIM,NETTO,KOL
ЭК,2021,KZ,9504500002,796,38333.71,235.313,495
ИМ,2021,BY,9403903000,,1526541.73,1045093.246,27
ЭК,2021,PL,XXXXXXXXXX,,193128686.73,0.051005,0
ИМ,2021,CN,9605000000,796,63869.66,10248.844,191925
ЭК,2021,FR,2711210000,113,0,0,1172643429
```

- **Разделитель:** `,` (запятая)
- **Кодировка:** UTF-8

## Модель данных ФТС

| Колонка | Тип | Описание | Пример |
|---------|-----|----------|--------|
| **NAPR** | VARCHAR | Направление: `ИМ` (импорт), `ЭК` (экспорт) | `ЭК` |
| **PERIOD** | INT | Год отчётного периода (месяц берётся из имени файла) | `2021` |
| **STRANA** | VARCHAR | ISO2 код страны-партнёра | `KZ`, `CN`, `DE` |
| **TNVED** | VARCHAR | Код ТН ВЭД, 10 знаков. `XXXXXXXXXX` — засекреченные данные | `9504500002` |
| **EDIZM** | VARCHAR | Код единицы измерения (справочник `metadata/edizm.csv`). Пусто — нет доп. единицы | `796` (штука), `113` (м³) |
| **STOIM** | DECIMAL | Статистическая стоимость, тыс. USD | `38333.71` |
| **NETTO** | DECIMAL | Вес нетто, кг | `235.313` |
| **KOL** | DECIMAL | Количество в единице EDIZM | `495` |

## Особенности

- **PERIOD в файле** — только год. Месяц определяется по имени файла (`2021-01.csv` → январь 2021).
- **TNVED = XXXXXXXXXX** — засекреченные товарные позиции (агрегат по нескольким кодам).
- **EDIZM** — числовой код из справочника (796 = ШТУКА, 113 = КУБИЧЕСКИЙ МЕТР). Пустое значение — доп. единица не применяется.
- **STOIM, NETTO, KOL** — могут быть 0 (например, при учёте только объёма в KOL для газов).

## Запуск

Скрипт `src/load_fts_csv.py` загружает все CSV из `data_raw/fts_data/`, объединяет их и сохраняет в Parquet.

**Без фильтра (все коды ТН ВЭД):**
```bash
python src/load_fts_csv.py
```
Результат: `data_interim_csv/fts_2021_2022.parquet`

**Фильтр по 2-значному коду ТН ВЭД:**
```bash
python src/load_fts_csv.py --tnved2 27
```
Результат: `data_interim_csv/fts_2021_2022_TNVED2_27.parquet`

**Фильтр по 4-значному коду ТН ВЭД:**
```bash
python src/load_fts_csv.py --tnved4 2710
```
Результат: `data_interim_csv/fts_2021_2022_TNVED4_2710.parquet` (при указании `--tnved4` фильтр по 2 знакам задаётся автоматически).

**Аргументы:**
- `--tnved2 <код>` — оставить только строки с заданным 2-значным кодом (например, `27`).
- `--tnved4 <код>` — оставить только строки с заданным 4-значным кодом (например, `2710`); при указании переопределяет `--tnved2`.
- `--output-dir <путь>` — папка для сохранения (по умолчанию: `data_interim_csv`).

Имя сохраняемого файла всегда отражает применённый фильтр: без фильтра — `fts_2021_2022.parquet`, с `--tnved2` — суффикс `_TNVED2_XX`, с `--tnved4` — суффикс `_TNVED4_XXXX`.
