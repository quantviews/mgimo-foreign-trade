# Документация для `india_collector.py`

Этот документ описывает работу скрипта `india_collector.py`, его основную логику и способы использования для сбора данных о внешней торговле Индии.

## Описание

Скрипт `india_collector.py` предназначен для автоматического сбора данных о внешней торговле Индии с официального портала Министерства торговли и промышленности Индии (`https://tradestat.commerce.gov.in/meidb/`). Он позволяет получать детализированную информацию по экспорту и импорту на уровне 8-значных кодов ТН ВЭД (HS Code).

## Логика работы скрипта

Скрипт выполняет следующие шаги для получения данных:

1.  **Инициализация сессии**: Скрипт начинает с создания `requests.Session`, чтобы управлять cookies и CSRF-токенами, необходимыми для взаимодействия с сайтом.
2.  **Получение CSRF-токена**: Перед отправкой POST-запроса на получение данных, скрипт делает GET-запрос на страницу, чтобы извлечь уникальный CSRF-токен. Этот токен обязателен для аутентификации запросов.
3.  **Параллельные запросы**: Сбор данных для экспорта (`Ex`) и импорта (`Im`) выполняется параллельно с использованием `ThreadPoolExecutor` для ускорения процесса.
4.  **Сбор различных типов данных**: Для каждого направления (экспорт/импорт) скрипт последовательно запрашивает три типа данных:
    *   Стоимость в долларах США (`usd`)
    *   Стоимость в индийских рупиях (`inr`)
    *   Количество в единицах измерения (`quantity`)
5.  **Парсинг HTML**: Ответ от сервера приходит в виде HTML-страницы. Скрипт использует `BeautifulSoup` для парсинга этой страницы и извлечения данных из таблицы.
6.  **Обработка и объединение данных**:
    *   Данные из каждого запроса преобразуются в `pandas.DataFrame`.
    *   Результаты для `usd`, `inr` и `quantity` объединяются в один `DataFrame` для каждого направления (экспорт/импорт) по коду ТН ВЭД и наименованию товара.
    *   Затем данные по экспорту и импорту объединяются в один итоговый `DataFrame`.
7.  **Постобработка**: К финальному набору данных применяются следующие преобразования:
    *   Стоимости в USD умножаются на 1000 (данные на сайте представлены в USD, мы приводим к тыс.).
    *   Названия столбцов приводятся к стандартному виду, используемому в проекте (`TNVED`, `STOIM`, `NAPR` и т.д.).
    *   Создаются дополнительные столбцы с кодами ТН ВЭД на уровне 2, 4 и 6 знаков, а также колонка `PERIOD`.
8.  **Сохранение данных**: Обработанный `DataFrame` сохраняется в файл формата `.csv` в директорию `data_raw/india_new/` с именем `india_ГОД_МЕСЯЦ.csv`.

## Как запустить скрипт

Для запуска скрипта используйте командную строку. Перейдите в директорию `src/collectors` и выполните команду `python india_collector.py` с нужными аргументами.

### Аргументы командной строки

Скрипт поддерживает следующие аргументы:

*   `--year`, `--month`: Для сбора данных за **один конкретный месяц**. Оба аргумента должны быть указаны вместе.
*   `--start_year`, `--start_month`: Для указания **начала периода** сбора данных.
*   `--end_year`, `--end_month`: Для указания **конца периода** сбора данных.

### Примеры использования

1.  **Сбор данных за конкретный месяц (например, Август 2025):**

    ```bash
    python india_collector.py --year 2025 --month 9
    ```

2.  **Сбор данных за определенный период (например, с Мая 2022 по Июнь 2023):**

    ```bash
    python india_collector.py --start_year 2022 --start_month 5 --end_year 2023 --end_month 6
    ```

3.  **Сбор данных с начала 2021 года до текущего момента:**

    ```bash
    python india_collector.py --start_year 2021
    ```

4.  **Сбор всех данных по умолчанию (с Января 2018 до текущего месяца):**

    Если запустить скрипт без аргументов, он начнет сбор данных с января 2018 года по текущий месяц.

    ```bash
    python india_collector.py
    ```
