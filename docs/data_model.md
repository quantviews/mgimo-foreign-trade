# Модель данных для гармонизированных таблиц таможеннной статистики 

Этот документ описывает стандартизированную модель данных, используемую для итоговых, гармонизированных наборов данных в директории `data_processed`. Все сырые данные, собранные из разных источников (Китай, Турция, Индия и т.д.), преобразуются в соответствие с этой схемой.

## Схема таблицы

| Название колонки | Тип данных    | Описание                                                                                                                                    | Пример         |
|------------------|---------------|---------------------------------------------------------------------------------------------------------------------------------------------|----------------|
| `NAPR`           | `VARCHAR`     | **Направление торгового потока.** Указывает, является ли торговый поток импортом или экспортом по отношению к Российской Федерации. (`ИМ` = Импорт, `ЭК` = Экспорт). | `ИМ`           |
| `PERIOD`         | `DATE`        | **Отчетный период.** Первый день месяца, за который представлены данные. Всегда хранится в формате `YYYY-MM-DD`.                          | `2023-01-01`   |
| `STRANA`         | `VARCHAR`     | **Страна-партнер.** Двухбуквенный ISO-код страны-партнера (например, `CN` для Китая, `TR` для Турции).                                          | `CN`           |
| `TNVED`          | `VARCHAR`     | **Код ТН ВЭД (Товарная номенклатура внешнеэкономической деятельности).** Полный товарный код, дополненный нулями слева до 8 или 10 знаков в зависимости от исходной системы. | `0101210000`   |
| `EDIZM`          | `VARCHAR`     | **Оригинальная единица измерения.** Единица измерения для колонки `KOL`, как она указана в исходных данных (например, "Number of item", "kg"). `?` означает отсутствующую или неизвестную единицу. | `Number of item` |
| `EDIZM_ISO`      | `VARCHAR`     | **Код стандартизированной единицы измерения.** Код из справочника `metadata/edizm.csv` для унификации единиц измерения. | `166`          |
| `STOIM`          | `DECIMAL`     | **Стоимость (USD).** Статистическая стоимость товаров в долларах США.                                                                      | `12500.50`     |
| `NETTO`          | `DECIMAL`     | **Вес нетто (кг).** Вес нетто товаров в килограммах.                                                                                         | `450.0`        |
| `KOL`            | `DECIMAL`     | **Дополнительное количество.** Количество товаров в единицах, указанных в колонке `EDIZM`.                                                   | `150`          |
| `TNVED4`         | `VARCHAR`     | **Код ТН ВЭД (4 знака).** Первые 4 знака кода `TNVED`, представляющие товарную позицию ТН ВЭД.                                                 | `0101`         |
| `TNVED6`         | `VARCHAR`     | **Код ТН ВЭД (6 знаков).** Первые 6 знаков кода `TNVED`, представляющие субпозицию ТН ВЭД.                                                    | `010121`       |
| `TNVED2`         | `VARCHAR`     | **Код ТН ВЭД (2 знака).** Первые 2 знака кода `TNVED`, представляющие группу ТН ВЭД.                                                         | `01`           |

## Ключевые концепции и преобразования

- **Гармонизация:** Основная цель скриптов обработки — взять сырые данные в различных форматах и привести их к этой единой, последовательной структуре. Это позволяет проводить унифицированный анализ по разным странам и периодам времени.
- **Дополнение нулями:** Товарные коды (`TNVED` и его производные) хранятся в виде строк и дополняются нулями слева для обеспечения постоянной длины и правильной сортировки.
- **Нормализация периода:** Все индикаторы даты из исходных источников (например, `202301`, `Jan-2023`) нормализуются к первому дню соответствующего месяца (`2023-01-01`).
- **Направление торгового потока:** Колонка `NAPR` является ключевой. Ее значение определяется на основе источника. Например, при обработке данных об *экспорте* из Китая в Россию, для России этот поток является *импортом* (`ИМ`). То есть, для национальных данных необходимо **изменить** направление потока: Export -> `ИМ`, Import -> 'ЭК`. 
- **Стандартизация единиц измерения:** Оригинальные единицы измерения из колонки `EDIZM` сопоставляются со стандартным справочником (`metadata/edizm.csv`) для получения унифицированного кода в колонке `EDIZM_ISO`.
