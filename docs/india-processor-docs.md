# Документация для `india_processor.py`

Этот документ описывает работу скрипта `india_processor.py`, который отвечает за обработку и объединение сырых данных о внешней торговле Индии.

## Описание

Скрипт `india_processor.py` предназначен для обработки всех сырых `.csv` файлов, собранных с помощью `india_collector.py`. Он автоматизирует процесс очистки, стандартизации, обогащения и объединения данных, создавая единый, готовый к анализу файл в формате Parquet.

## Логика работы скрипта

Скрипт выполняет следующие шаги:

1.  **Загрузка сопоставлений (mappings)**:
    *   **Коды единиц измерения**: Внутри скрипта определен словарь `EDIZM_TO_ISO` для перевода сокращенных названий единиц измерения, используемых в индийских данных (например, "KGS", "LTR"), в их стандартные ISO-коды ("166", "112").
    *   **Русские названия единиц измерения**: Скрипт загружает файл `metadata/edizm.csv`, чтобы сопоставить ISO-коды с их официальными русскими названиями (например, "166" -> "КИЛОГРАММ").

2.  **Поиск сырых данных**: Скрипт сканирует директорию `data_raw/india_new/` и находит все файлы, соответствующие шаблону `india_*.csv`.

3.  **Обработка каждого файла**:
    *   **Создание периода**: Объединяет колонки `Year` и `Month` для создания стандартной колонки `PERIOD`.
    *   **Очистка**: Числовые колонки (`STOIM`, `NETTO`, `KOL`) приводятся к числовому формату.
    *   **Конвертация стоимости**: Значения в колонке `STOIM` (в миллионах USD) умножаются на 1000 для приведения к тысячам USD, что соответствует общей модели данных проекта.
    *   **Обогащение данных (EDIZM)**:
        *   На основе сокращенного названия из колонки `EDIZM` для каждой строки определяется ISO-код единицы измерения, который записывается в колонку `EDIZM_ISO`.
        *   На основе `EDIZM_ISO` из сопоставления подставляется русское название единицы измерения в колонку `EDIZM`.
    *   **Приведение к модели**: Выбираются только необходимые колонки (`NAPR`, `PERIOD`, `STRANA`, `TNVED` и т.д.), чтобы соответствовать стандартной схеме данных.

4.  **Объединение данных**: Все обработанные данные из отдельных файлов объединяются в один итоговый DataFrame.

5.  **Финализация**:
    *   Удаляются полные дубликаты строк.
    *   Данные сортируются по периоду, направлению и коду ТН ВЭД.

6.  **Сохранение результата**: Финальный набор данных сохраняется в файл `data_processed/in_full.parquet`. Если файл с таким именем уже существует, он будет **перезаписан**.

## Как запустить скрипт

### Требования
*   Наличие сырых данных в `data_raw/india_new/`, собранных с помощью `india_collector.py`.
*   Наличие файла `metadata/edizm.csv`.

### Запуск

Скрипт не требует аргументов командной строки. Для запуска достаточно выполнить команду в терминале из корневой директории проекта:

```bash
python src/collectors/india_processor.py
```

После выполнения скрипта в директории `data_processed` появится (или обновится) файл `in_full.parquet`.
