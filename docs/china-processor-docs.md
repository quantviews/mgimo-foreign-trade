# Документация для `china_processor.py`

Этот документ описывает работу скрипта `china_processor.py`, который отвечает за обработку и объединение сырых данных о внешней торговле Китая.

## Описание

Скрипт `china_processor.py` предназначен для обработки всех сырых `.csv` файлов, собранных с помощью `china-collector.py`. Он автоматизирует процесс очистки, стандартизации, обогащения и объединения данных, создавая единый, готовый к анализу файл в формате Parquet.

## Логика работы скрипта

Скрипт выполняет следующие шаги:

1.  **Загрузка сопоставлений (mappings)**:
    *   **Коды ТН ВЭД Китая**: Скрипт загружает данные из `.csv` файлов в директории `metadata/china-codes/`. Эти файлы содержат сопоставления между 8-значными кодами ТН ВЭД и единицами измерения на английском языке (например, "Kilogram").
    *   **ISO-коды единиц измерения**: Внутри скрипта определено сопоставление для перевода английских названий единиц измерения в их международные ISO-коды (например, "Kilogram" -> "166").
    *   **Русские названия единиц измерения**: Скрипт загружает файл `metadata/edizm.csv`, чтобы сопоставить ISO-коды с их официальными русскими названиями (например, "166" -> "КИЛОГРАММ").

2.  **Поиск сырых данных**: Скрипт сканирует директории `data_raw/china/IMPORT` и `data_raw/china/EXPORT` и находит все файлы, соответствующие шаблону `data*.csv`.

3.  **Обработка каждого файла**:
    *   **Очистка**: Числовые колонки (`STOIM`, `NETTO`, `KOL`) очищаются от текстовых символов и приводятся к числовому формату.
    *   **Стандартизация**: Коды ТН ВЭД (`TNVED`, `TNVED2`, `TNVED4`, `TNVED6`) дополняются ведущими нулями до нужной длины.
    *   **Обогащение данных**:
        *   На основе кода `TNVED` для каждой строки определяется ISO-код единицы измерения и записывается в колонку `EDIZM_ISO`.
        *   На основе `EDIZM_ISO` из сопоставления подставляется русское название единицы измерения в колонку `EDIZM`.
    *   **Приведение к модели**: Данные приводятся в соответствие с общей моделью: добавляется колонка `STRANA` со значением `CN`, форматируется колонка `PERIOD`.

4.  **Объединение данных**: Все обработанные данные из отдельных файлов объединяются в один итоговый DataFrame.

5.  **Проверка на пропуски**: Скрипт анализирует временной ряд в колонке `PERIOD` и выводит предупреждение, если в последовательности данных отсутствуют какие-либо месяцы.

6.  **Сохранение результата**: Финальный набор данных сохраняется в файл `data_processed/ch_full.parquet`. Если файл с таким именем уже существует, он будет **перезаписан**.

## Как запустить скрипт

### Требования
*   Наличие сырых данных в `data_raw/china/`, собранных с помощью `china-collector.py`.
*   Наличие файлов сопоставления в `metadata/china-codes/`.
*   Наличие файла `metadata/edizm.csv`.

### Запуск

Скрипт не требует аргументов командной строки. Для запуска достаточно выполнить команду в терминале из корневой директории проекта:

```bash
python src/collectors/china_processor.py
```

После выполнения скрипта в директории `data_processed` появится (или обновится) файл `ch_full.parquet`.
